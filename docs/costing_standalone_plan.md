# 스탠드얼론 원가 계산 모듈 설계 개요

## 모듈 구조
- `src/pages/costing-standalone/`
  - `StandaloneCostingPage.tsx`: 최상위 페이지 및 단계별 섹션 렌더링
  - `components/`: 폼 섹션, 리스트, 모달 등 UI 구성요소
  - `state/StandaloneCostingProvider.tsx`: 컨텍스트 + reducer, localStorage 연동
  - `hooks/` (필요 시): 도메인별 커스텀 훅
- `src/services/standaloneCosting/`
  - `types.ts`: 운영 설정, 인력, 소모품, 고정비, 시술, 결과 등의 타입
  - `calculations.ts`: 원가 산출 순서, 수식, 포맷팅 유틸
  - `storage.ts`: localStorage 초안 저장소 (향후 Supabase 연동 인터페이스 교체)

## 상태 슬라이스
- `operational`: 월 영업일, 일일 영업시간, 총 시술실 수, 참고 메모
- `staff`: 역할 ID, 이름, 월급, 월 근무일/시간, 메모
- `materials`: 소모품 ID, 이름, 기본 단위(샷/cc 등), 기본 수량, 기본 단가, 메모
- `fixedCosts`: 사용자 정의 고정비 항목 ID, 이름, 월 금액, 분류
- `procedures`: 시술 ID, 상품명, 판매가, 시술 소요시간, 총 체류시간, 인력 투입 목록, 소모품 사용 목록, 메모
- `results`: 계산된 비용(직접비/고정비 배분/마진 등)을 캐시하여 리스트 표시
- `draftMetadata`: 마지막 저장 시각, 로드 여부 표시

## 주요 계산 로직
1. 총 가용 시간(분) = `월 영업일 × 일일 영업시간 × 60`
2. 인력 분당 비용 = `월급 ÷ (월 근무일 × 60 × 1일 근무시간)`
3. 시술 직접 인건비 = ∑(투입 인력 분당 비용 × 해당 인력 투입시간)
4. 소모품 비용 = ∑((소모품 단가 ÷ 기본 수량) × 사용량)
5. 고정비 분당 비용 = `각 항목 금액 ÷ 총 가용 시간`; 시술 소요시간에 곱하여 배분
6. 총 원가 = 직접 인건비 + 소모품 + 배분 고정비
7. 마진 = 판매가 − 총 원가, 마진율 = `마진 ÷ 판매가`
8. 손익분기 건수 = `고정비 합계 ÷ (판매가 − 직접비)` (판매가가 직접비 이하일 경우 경고)

## UX 섹션
1. **운영 설정** (저장 버튼): 필수 값 미입력 시 경고
2. **인력 관리**: 리스트 + 추가/편집 모달, 삭제 시 연관 시술 경고
3. **소모품 관리**: 단위·기본 수량 입력, 시술 연결 시 비용 자동 계산
4. **고정비 관리**: 기본 항목 프리셋 + 사용자 정의 항목, 분당 비용 미리보기
5. **시술 등록**: 시술 입력, 인력 선택/시간, 소모품 선택/사용량, 저장 시 결과 반영
6. **결과 대시보드**: 시술별 비용/마진/손익분기표, CSV 내보내기

## 주요 고려사항
- 모든 입력/리스트 UI는 한국어 고정, 통화 포맷은 `1,234,567원`
- `localStorage` 키: `standaloneCosting.v1` (병원별 구분 필요 시 테넌트 ID 접두어 활용)
- 추후 Supabase 연동 시 REST/RPC 클라이언트로 교체할 수 있도록 `storage` 레이어를 인터페이스화
- 마케팅/금융 시나리오는 2차 기능으로 분리, 현재는 토글/입력 제거

## 다음 단계
1. 기존 `CostingRouter` 및 관련 컨텍스트 제거 → 새 페이지 라우트 등록
2. `StandaloneCostingProvider` 생성 및 상태/액션 정의
3. 섹션별 폼 컴포넌트 구현, 저장 시 reducer 액션 호출
4. 계산 로직 및 결과 리스트 UI 완성 후 통화 포맷 적용
