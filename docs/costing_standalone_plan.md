# 코스팅 스탠드얼론 설계 개요

## 화면 구조
- 탭 구성: 운영 세팅 → 장비 관리 → 인력 관리 → 소모품 관리 → 인건비 제외 고정비 입력 → 시술 등록 → 결과 대시보드 → 시나리오·마케팅 인사이트
- 각 탭은 완료 여부를 체크해서 선행 데이터가 없을 경우 기존 공통 모달을 호출해 입력을 유도합니다.
- 시술 등록과 결과 대시보드는 한 화면에서 리스트·미리보기·테이블을 모두 확인할 수 있도록 구성합니다.

## 상태 및 저장 전략
- `StandaloneCostingProvider` 는 Prisma + SQLite 기반 API(`/api/standalone-costing`)로 상태를 저장하며, JSON 스냅샷을 저장해 향후 Supabase(Postgres) 의 JSONB 스키마와 호환됩니다.
- 로딩 시 구버전 드래프트는 시설·운영비로 기본 분류되도록 마이그레이션하며, 브라우저 알림으로 안내합니다.
- `normalizeFixedCosts` 를 통해 모든 고정비 항목에 `costGroup`(facility/common)을 보장하고 이후 Supabase 연동 시 동일 스키마를 사용합니다.

## 고정비 분류 로직
- 시설·운영비(facility): 임대료·관리비·장비 리스 등 시간을 기준으로 분당 배분되는 항목.
- 공통비용(common): 마케팅비·보험료·카드 수수료 등 시간과 무관한 항목으로 시나리오 탭에서 가감합니다.
- UI 는 그룹 토글 + 예시 안내를 제공하고, 그룹별 합계 카드와 테이블을 별도 렌더링합니다.

## 원가 계산 방식
1. 월 가용 시간 = 영업일 × 1일 영업시간 × 60분.
2. 인력 분당 단가 = 월급 ÷ (월 근무일 × 1일 근무시간 × 60분).
3. 시술 직접 인건비 = 참여 인력 분당 단가 × 투입 시간 합계.
4. 소모품 비용 = (단위가격 ÷ 단위수량) × 사용수량 (샷·cc 등을 그대로 사용).
5. 시설·운영비 분당 배분 = 시설·운영비 월합계 ÷ 월 가용 시간.
6. 시술별 총 원가 = 직접 인건비 + 소모품 비용 + (시설·운영비 분당 배분 × 총 체류시간).
7. 마진/마진율 = 판매가 - 총 원가, {margin ÷ price} × 100.
8. 손익분기 건수 = 시설·운영비 월합계 ÷ (판매가 - 직접비) (기여이익이 0 이하이면 계산 불가).

## 결과 및 시나리오 UX
- 결과 대시보드 상단에 시설·운영비, 공통비용, 평균 마진율, 최소 손익분기 건수를 카드 형태로 요약합니다.
- 시나리오 탭에서는 고정비에서 입력한 공통비용 금액을 불러온 뒤 ± 조정 입력을 받아 가정 시나리오를 계산합니다.
- 마케팅비 조정 후 ROI/ROAS/CAC 계산과 GPT 분석을 위한 플레이스홀더를 유지하며, 향후 API 연동 시 확장합니다.

## 향후 작업 목록
1. 시나리오 계산 로직 구현(공통비용 가감, 예상 건수 입력, KPI 산출) 및 마케팅 용어 툴팁 보강.
2. 로컬 상태 버전화(예: `standaloneCosting.v2`)와 마이그레이션 안내 UI 정비.
3. 장비 위계 토글이 활성화될 때 장비-소모품-시술 매핑 및 리스료 배분 로직 추가.
4. 공통비용 상세 입력 Preset(예: 일반 관리비, 기타) 추가와 CSV 내보내기 요구사항 정리.
5. 시나리오/마케팅 페이지에서 LLM 분석을 호출할 프롬프트 템플릿 초안 작성.
